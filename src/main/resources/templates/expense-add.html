<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
  <meta charset="UTF-8">
  <title>Add Expense</title>
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Include Bootstrap's JavaScript after jQuery -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <!-- Include jquery.dataTables.min.js after jQuery -->
  <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

 
</head>

<body>
  <div th:replace="~{fragments/navbar :: navbar}"></div>
  <div class="container my-8">
    <div class="row">
      <div class="col-md-6">
        <h1>Add Expense</h1>
        <form th:action="@{/expenses/save}" th:object="${expense}" method="post">
            <table class="table table-striped">
                <tr>
                    <td>
                      <div class="form-group">
                        <label for="district">District:</label>
                        <select class="form-control" id="district" name="district.did" required>
                          <option value="" selected>Select District</option>
                          <option th:each="district : ${districts}" th:value="${district.did}" th:text="${district.district}"></option>
                        </select>
                      </div>
                    </td>
                    
                    <td>
                      <div class="form-group">
                        <label for="lokal">Lokal:</label>
                        <select class="form-control" id="lokal" name="lcode" required>
                          <option value="" selected>Select Lokal</option>
                        </select>
                      </div>
                    </td>
                    </tr>
                    <tr>
                    <td>
                      <div class="form-group">
                        <label for="wkno">Week Number:</label>
                        <input type="text" class="form-control" id="wkno" name="wkno" pattern="[0-9]{2}-[0-9]{4}" required>
                        <div class="invalid-feedback">
                          Please enter a valid week number (week-yyyy).
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <label for="description">Description:</label>
                        <textarea class="form-control" id="description" name="description" required></textarea>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="4">
                      <div class="form-group">
                        <label for="f10">F10:</label>
                        <input type="text" class="form-control" id="f10" name="f10" required>
                      </div>
                    </td>
                  </tr>
                  <tr>  
                    <td>
                      <div class="form-group">
                        <label for="amountRequested">Amount Requested:</label>
                        <input type="number" class="form-control" id="amountRequested" name="amountRequested" min="0" required>
                      </div>
                    </td>
                    <td>
                        <div class="form-group">
                          <label for="actualExpenses">Amount:</label>
                          <input type="number" class="form-control" id="actualExpenses" name="actualExpenses" min="0" required>
                        </div>
                      </td>
                   </tr>
                   <tr>
                    <td>
                      <div class="form-group">
                        <label for="datePurchased">Date Purchased:</label>
                        <input type="date" class="form-control" id="datePurchased" name="datePurchased" required>
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <label for="remarks">Remarks:</label>
                        <textarea class="form-control" id="remarks" name="remarks"></textarea>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-group">
                        <label for="qty">Quantity:</label>
                        <input type="number" class="form-control" id="qty" name="qty" min="0" required>
                      </div>
                    </td>
                    <td>
                      <div class="form-group">
                        <label for="exptype">Expense Type:</label>
                        <select class="form-control" id="exptype" name="exptype" required>
                          <option value="" selected>Select Expense Type</option>
                          <option value="Locale">Locale</option>
                          <option value="Central">Central</option>
                        </select>
                      </div>
                    </td>
                   </tr>
                   <tr>
                    <td colspan="4" class="text-center">
                      <button type="submit" class="btn btn-primary btn-lg">Add Expense</button>
                    </td>
                  </tr>
             </table>     
        </form>

      </div>
    </div>
  </div>

  <script>
    $(document).ready(function () {
      $('#district').change(function () {
        var did = $(this).val();
        $.get('/getlocales/' + did, function (data) {  // @GetMapping("/getlocales/{districtId}")
          $('#lokal').empty();
          $('#lokal').append($('<option>').val('').text('Select Lokal'));
          $.each(data, function (i, lokal) {
            $('#lokal').append($('<option>').val(lokal.lcode).text(lokal.locale));
          });
        });
      });
    });
  </script>
<div class="col-md-6">
  <h2>Recent Expenses</h2>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Description</th>
        <th>Amount</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody id="recentExpensesBody">
    </tbody>
  </table>
</div>
<script>
    $(document).ready(function() {
  // Function to update the recent expenses table
  function updateRecentExpenses() {
    $.get("/expenses/recent", function(data) { // @GetMapping("/expenses/recent")
      // Clear the table body
      $("#recentExpensesBody").empty();
      
      // Add the new rows
      $.each(data, function(i, expense) {
        var row = $("<tr>");
        row.append($("<td>").text(expense.date));
        row.append($("<td>").text(expense.description));
        row.append($("<td>").text(expense.amount));
        row.append($("<td>").text(expense.remarks));
        $("#recentExpensesBody").prepend(row);
      });
    });
  }
  
  // Call the function initially to load the recent expenses
  updateRecentExpenses();
  
  // Add an event listener to the form to update the recent expenses after submitting the form
  $("form").submit(function() {
    $.ajax({
      url: $(this).attr("action"),
      method: $(this).attr("method"),
      data: $(this).serialize(),
      success: function(data) {
        // Update the recent expenses table
        updateRecentExpenses();
        
        // Reset the form
        $("form")[0].reset();
        $("#district").val("");
        $("#lokal").empty();
        $("#lokal").append($("<option>").val("").text("Select Lokal"));
      }
    });
    
    return false;
  });
});

</script>
  <div class="container-fluid" th:replace="~{fragments/footer :: footer}"></div>
</body>

</html>

